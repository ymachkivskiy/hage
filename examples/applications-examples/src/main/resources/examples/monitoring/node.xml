<?xml version="1.0" encoding="UTF-8" ?>
<configuration xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
               xmlns="http://age.iisg.agh.edu.pl/schema/age"
               xsi:schemaLocation="http://age.iisg.agh.edu.pl/schema/age http://age.iisg.agh.edu.pl/schema/age/age.xsd">

    <component class="org.jage.communication.HazelcastCommunicationManager"/>
    <component class="org.jage.configuration.service.ConfigurationStorageService"/>
    <component class="org.jage.configuration.service.ConfigurationLoaderService"/>
    <component class="org.jage.bus.EventBus">
        <constructor-arg name="name" type="String" value="mainBus"/>
    </component>

    <component name="workplaceManager" class="org.jage.workplace.manager.DefaultWorkplaceManager"/>
    <component class="org.jage.lifecycle.AutoExitHook"/>

    <block name="monitoring">
        <component class="org.jage.monitoring.Monitoring">
            <component class="org.jage.monitoring.config.DefaultComputationInstanceProvider"/>
            <component class="org.jage.monitoring.config.ExecutorProvider"/>
            <component class="org.jage.monitoring.config.ExecutorShutdownCaller"/>
            <component class="org.jage.monitoring.config.RxComputationSchedulerProvider"/>

            <component name="stringQuery" class="org.jage.monitoring.supplier.AgentStringQuerySupplier">
                <constructor-arg name="query" value="/TheXFiles/Scully@alienAbductions"/>
            </component>

            <component name="random" class="org.jage.monitoring.supplier.RandomSupplier"/>

            <component name="randomProvider" class="org.jage.monitoring.observable.ObservableProvider">
                <constructor-arg name="supplier" ref="random"/>
                <constructor-arg name="rate" value="1000" type="Long"/>
            </component>

            <component name="queryProvider" class="org.jage.monitoring.observable.ObservableProvider">
                <constructor-arg name="supplier" ref="stringQuery"/>
                <constructor-arg name="rate" value="1000" type="Long"/>
            </component>

            <list name="observers">
                <component name="logging" class="org.jage.monitoring.observer.LoggingObserver"/>
            </list>
            <constructor-arg>
                <component class="org.jage.monitoring.config.XmlConfig">
                    <constructor-arg>
                        <list>
                            <component name="handler1" class="org.jage.monitoring.handler.HandlerFactoryProvider">
                                <constructor-arg name="name" value="handler1"/>
                                <constructor-arg name="observableProviders">
                                    <list name="observableProviders">
                                        <reference target="queryProvider"/>
                                        <reference target="randomProvider"/>
                                    </list>
                                </constructor-arg>
                                <constructor-arg name="observers" ref="observers"/>
                                <constructor-arg name="clazz" value="org.jage.monitoring.handler.AvgHandlerFactory"/>
                                <constructor-arg name="method" value="create"/>
                            </component>

                            <component name="handler2" class="org.jage.monitoring.handler.HandlerFactoryProvider">
                                <constructor-arg name="name" value="handler2"/>
                                <constructor-arg name="observableProviders">
                                    <list>
                                        <reference target="queryProvider"/>
                                    </list>
                                </constructor-arg>
                                <constructor-arg name="observers" ref="observers"/>
                                <constructor-arg name="clazz" value="org.jage.monitoring.handler.BasicHandlerFactory"/>
                                <constructor-arg name="method" value="create"/>
                            </component>
                        </list>
                    </constructor-arg>
                </component>
            </constructor-arg>

            <constructor-arg>
                <component class="org.jage.monitoring.config.TypeSafeConfig">
                    <constructor-arg value="examples/monitoring/monitoring"/>
                </component>
            </constructor-arg>
        </component>
    </block>
</configuration>